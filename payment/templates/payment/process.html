{% extends "base.html" %}
{% load static %}

{% block title %}Payment â€¢ Deal Dazzle{% endblock %}

{% block content %}
<div class="wrapper">
    <main class="main-content">
        <div class="container">
            <!-- Checkout Progress -->
            <div class="checkout-progress">
                <div class="progress-step completed">
                    <div class="step-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="9" cy="21" r="1"></circle>
                            <circle cx="20" cy="21" r="1"></circle>
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                        </svg>
                    </div>
                    <div class="step-content">
                        <h3>Cart</h3>
                        <p>Review your items</p>
                    </div>
                </div>
                <div class="progress-step completed">
                    <div class="step-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                    </div>
                    <div class="step-content">
                        <h3>Shipping</h3>
                        <p>Enter your details</p>
                    </div>
                </div>
                <div class="progress-step active">
                    <div class="step-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                            <line x1="1" y1="10" x2="23" y2="10"></line>
                        </svg>
                    </div>
                    <div class="step-content">
                        <h3>Payment</h3>
                        <p>Complete your purchase</p>
                    </div>
                </div>
            </div>

            <div class="order-card">
                <div class="order-header">
                    <h1>Review & Pay</h1>
                    <p class="order-subtitle">Please review your order and complete payment</p>
                </div>

                <div class="order-items">
                    {% for item in order.items.all %}
                    <div class="order-item">
                        <div class="item-image">
                            <img src="{% if item.product.image %}{{ item.product.image.url }}{% else %}{% static 'image/default_image.png' %}{% endif %}"
                                 alt="{{ item.product.name }}">
                        </div>
                        <div class="item-details">
                            <h3>{{ item.product.name }}</h3>
                            <div class="item-meta">
                                <span class="quantity">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="12" y1="8" x2="12" y2="16"></line>
                                        <line x1="8" y1="12" x2="16" y2="12"></line>
                                    </svg>
                                    {{ item.quantity }}
                                </span>
                                <span class="price">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="12" y1="1" x2="12" y2="23"></line>
                                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                    </svg>
                                    {{ item.price }}
                                </span>
                            </div>
                        </div>
                        <div class="item-total">
                            ${{ item.get_cost }}
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <div class="order-summary">
                    <div class="summary-row">
                        <span>Subtotal</span>
                        <span>${{ order.get_total_cost }}</span>
                    </div>

                    {% if order.coupon %}
                    <div class="summary-row">
                        <span>Subtotal before discount</span>
                        <span>${{ order.get_total_cost_before_discount|floatformat:2 }}</span>
                    </div>
                    <div class="summary-row discount">
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20.91 8.84L8.56 21.19a2.32 2.32 0 0 1-3.28 0L1.65 17.56a2.32 2.32 0 0 1 0-3.28L13.99 1.94a2.32 2.32 0 0 1 3.28 0l3.64 3.64a2.32 2.32 0 0 1 0 3.28z"></path>
                                <line x1="7" y1="15" x2="9" y2="17"></line>
                            </svg>
                            "{{ order.coupon.code }}" ({{ order.discount }}% off)
                        </span>
                        <span class="discount-amount">- ${{ order.get_discount|floatformat:2 }}</span>
                    </div>
                    {% endif %}

                    <div class="summary-row">
                        <span>Shipping</span>
                        <span class="shipping-free">Free</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total to pay</span>
                        <span>${{ order.get_total_cost|floatformat:2 }}</span>
                    </div>
                </div>

                <div class="payment-security">
                    <div class="security-item">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>
                        <span>Secure Payment</span>
                    </div>
                    <div class="security-item">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                        </svg>
                        <span>SSL Encrypted</span>
                    </div>
                    <div class="security-item">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                        <span>Guaranteed Safe</span>
                    </div>
                </div>

                <form action="{% url 'payment:process' %}" method="post" class="payment-form">
                    {% csrf_token %}
                    <button type="submit" class="pay-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                            <line x1="1" y1="10" x2="23" y2="10"></line>
                        </svg>
                        Complete Payment
                    </button>
                </form>
            </div>
        </div>
    </main>
</div>
{% endblock %}